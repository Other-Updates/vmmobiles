<?php $theme_path = $this->config->item('theme_locations') . $this->config->item('active_template'); ?><script src="<?= $theme_path; ?>/js/jquery-1.8.2.js"></script><script src="<?= $theme_path; ?>/js/jquery-ui-my-1.10.3.min.js"></script><script type='text/javascript' src='<?= $theme_path; ?>/js/auto_com/jquery.autocomplete.js'></script><link rel="stylesheet" type="text/css" href="<?= $theme_path; ?>/js/auto_com/jquery.autocomplete.css" /><?php $theme_path = $this->config->item('theme_locations') . $this->config->item('active_template'); ?><link rel="stylesheet" href="<?= $theme_path; ?>/css/bootstrap-multiselect.css" type="text/css"/><script type="text/javascript" src="<?= $theme_path; ?>/js/bootstrap-multiselect.js"></script><script type="text/javascript" src="<?= $theme_path; ?>/js/employee.js"></script><style>    .req {        color: #FF0000;    }</style><div class="mainpanel">    <div class="media mt--20">        <h4>Daily Reports </h4>    </div>    <div class="contentpanel">        <div class="panel-body mt-top5">            <?php            $filter = $this->session_view->get_session(null, null);            $attributes = array('class' => 'stdform editprofileform', 'method' => 'post');            echo form_open('', $attributes);            ?>            <?php//            echo "<pre>";//            print_r($no_of_users1);//            exit;            if (isset($no_of_users1)) {                $options = array();                $this->load->model('masters/options_model');                $record = array(10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 120, 140, 160, 180, 200);                $closest = $this->options_model->getClosest(count($no_of_users1), $record);                //echo $closest;                for ($k = 10; $k <= $closest;) {                    $options[$k] = $k;                    if ($k < 100)                        $k = $k + 10;                    else                        $k = $k + 20;                }                if (count($no_of_users1) >= 1000) {                    $count_start = count($no_of_users1) / 100;                    if ($count_start >= 10) {                        for ($c = 4; $c < $count_start;) {                            $options[$c * 100] = $c * 100;                            $c+=2;                        }                    }                }                if (!in_array($count, $options)) {                    $max = $this->options_model->getClosest($count, $options);                    if ($max < count($no_of_users1))                        $count = "all";                    else                        $count = $max;                }                $options["all"] = "All";                echo "Show " . form_dropdown('record_show', $options, $count, "id='count_change'") . " entries";            }            ?>            <div class="scroll_bar">                <?php                $attributes = array('class' => 'attendance_data_form', 'method' => 'post');                echo form_open('', $attributes);                ?>                <table>                    <thead>                    <th class="action-btn-align">Date <span class="req">*</span>&nbsp;                        <?php                        $default = '';                        if (isset($filter["start_date"]) && $filter["start_date"] != "") {                            $default = date("d-m-Y", strtotime($filter["start_date"]));                        }                        $data = array(                            'id' => 'start_date',                            'name' => 'start_date',                            'class' => 'input-small today-date',                            'readonly' => 'readonly',                            'value' => $default                        );                        echo form_input($data);                        ?>                    </th>                    <th class="action-btn-align">To Date <span class="req">*</span>&nbsp;                        <?php                        $default = '';                        if (isset($filter["end_date"]) && $filter["end_date"] != "") {                            $default = date("d-m-Y", strtotime($filter["end_date"]));                        }                        $data = array(                            'id' => 'end_date',                            'name' => 'end_date',                            'class' => 'input-small today-date',                            'readonly' => 'readonly',                            'value' => $default                        );                        echo form_input($data);                        ?>                    </th>                    <th>&nbsp;                        <?php                        $data = array(                            'id' => 'attendance-search',                            'name' => 'search',                            'value' => 'Search',                            'class' => 'btn btn-warning border4',                            'title' => 'Search'                        );                        echo form_submit($data);                        ?>                    </th>                    </thead>                </table>                <?php                if (isset($start_date) && isset($end_date)) {                    $i = 0;                    $cnt = 1;                    while (strtotime($start_date) <= strtotime($end_date)) {                        ?> <div> <h5> <?php echo date('d-m-Y', strtotime($start_date)); ?></h5>                            <table  id="basicTable_call_back" class="table table-striped table-bordered responsive dataTable no-footer dtr-inline">                                <thead>                                    <tr>                                        <td class="action-btn-align">S.No</td>                                        <td class="action-btn-align">Employee Code</td>                                        <td class="action-btn-align">Employee Name</td>                                        <td class="action-btn-align">Shift</td>                                        <td class="action-btn-align">S.Intime</td>                                        <td class="action-btn-align">S.OutTime</td>                                        <td class="action-btn-align">A.InTime</td>                                        <td class="action-btn-align">A.OutTime</td>                                        <td class="action-btn-align">Work Duration</td>                                        <td class="action-btn-align">OT</td>                                        <td class="action-btn-align">Total Duration</td>                                        <td class="action-btn-align">LateBy</td>                                        <td class="action-btn-align">EarlyGoingBY</td>                                        <td class="action-btn-align">Status</td>                                        <td class="action-btn-align">Punch Records</td>                                    </tr>                                </thead>                                <tbody>                                    <?php if (empty($users[$i][$start_date])) { ?><tr><td colspan="15">No Records Found..</td></tr> <?php                                    } else {                                        $count = 1;                                        foreach ($users[$i][$start_date] as $value) {                                            ?>                                            <tr>                                                <td><?php echo $count; ?></td>                                                <td><?php echo $value['employee_id'] ?></td>                                                <td><?php echo ucwords($value['first_name']) . " " . ucwords($value['last_name']) ?></td>                                                <td><?php echo ucfirst($value['shift']); ?></td>                                                <td><?php                                                    if ($value['shift_id'] == 1) {                                                        echo '09:00';                                                    } else {                                                        echo '00:00';                                                    }                                                    ?></td>                                                <td></td>                                                <td></td>                                                <td></td>                                                <td></td>                                                <td></td>                                                <td></td>                                                <td></td>                                                <td></td>                                                <td></td>                                                <td></td>                                            </tr>                                            <?php                                            $count++;                                        }                                        ?>                                    <?php } ?>                                </tbody>                            </table> </div>                        <?php                        $i++;                        $cnt++;                        $start_date = date("Y-m-d", strtotime("+1 day", strtotime($start_date)));                    }                }                ?>                <table  id="basicTable_call_back" class="table table-striped table-bordered responsive dataTable no-footer dtr-inline">                    <thead>                        <tr>                            <td class="action-btn-align">S.No</td>                            <td class="action-btn-align">Employee Code</td>                            <td class="action-btn-align">Employee Name</td>                            <td class="action-btn-align">Shift</td>                            <td class="action-btn-align">S.Intime</td>                            <td class="action-btn-align">S.OutTime</td>                            <td class="action-btn-align">A.InTime</td>                            <td class="action-btn-align">A.OutTime</td>                            <td class="action-btn-align">Work Duration</td>                            <td class="action-btn-align">OT</td>                            <td class="action-btn-align">Total Duration</td>                            <td class="action-btn-align">LateBy</td>                            <td class="action-btn-align">EarlyGoingBY</td>                            <td class="action-btn-align">Status</td>                            <td class="action-btn-align">Punch Records</td>                        </tr>                    </thead>                    <tbody>                        <?php                        if (isset($users) && !empty($users)) {                            $i = 1;                            foreach ($users as $user) {                                ?>                                <tr>                                    <td class="first_td action-btn-align">                                        <?php echo $i ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php echo $user['employee_id'] ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?= ucwords($user['first_name']) . " " . ucwords($user['last_name']) ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php echo ucfirst($user['shift']); ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php                                        if ($user['shift_id'] == 1) {                                            echo '09:00';                                        } else {                                            echo '00:00';                                        }                                        ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php                                        if ($user['shift_id'] == 1) {                                            echo '18:00';                                        } else {                                            echo '00:00';                                        }                                        ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php echo $user['in'] ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php echo ($user['out'] != NULL) ? $user['out'] : '-'; ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php                                        if ($user['out'] == NULL) {                                            echo "-";                                        } else {                                            $in_secs = strtotime($user['in']);                                            $out_secs = strtotime($user['out']);                                            $work_duration = $out_secs - $in_secs;                                            $hours = floor($work_duration / 3600);                                            $mins = floor($work_duration / 60 % 60);                                            $secs = floor($work_duration % 60);                                            if ($work_duration > 32400) {                                                $alternate = 32400;                                                $hours = floor($alternate / 3600);                                                $mins = floor($alternate / 60 % 60);                                                $secs = floor($alternate % 60);                                            }                                            echo $timeFormat = sprintf('%02d:%02d:%02d', $hours, $mins, $secs);                                        }                                        ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php                                        if ($user['out'] == NULL) {                                            echo "00:00";                                        } else {                                            $overall_work_time = 32400;                                            $over_time = $work_duration - $overall_work_time;                                            $ot_hours = floor($over_time / 3600);                                            $ot_mins = floor($over_time / 60 % 60);                                            $ot_secs = floor($over_time % 60);                                            echo $OverTime = sprintf('%02d:%02d:%02d', $ot_hours, $ot_mins, $ot_secs);                                        }                                        ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php                                        if ($user['out'] == NULL) {                                            echo "-";                                        } else {                                            echo "-";                                        }                                        ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php echo "-"; ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php echo "-"; ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php echo "-"; ?>                                    </td>                                    <td class="first_td action-btn-align">                                        <?php echo "-"; ?>                                    </td>                                </tr>                                <?php                                $i++;                            }                        }                        ?>                    </tbody>                </table>            </div>        </div>    </div></div><script type="text/javascript">    $(document).ready(function () {        $(".reset").click(function () {            $.ajax({                url: BASE_URL + "api/reset_session/",                type: "POST",                data: {class: ct_class, method: ct_method},                success: function (res)                {                    window.location = window.location.pathname;                }            });        });        //$('#department_select').select2();    }</script>